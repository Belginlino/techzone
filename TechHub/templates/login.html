{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sign In â€” TechZone</title>
  <link rel="stylesheet" href="{% static 'css/auth.css' %}">
  <link rel="icon" type="image/x-icon" href="{% static 'favicon.ico' %}">
</head>
<body>
  <h1>Welcome</h1>

  <div class="container">
    <div class="welcome-section">
      <img src="{% static 'images/laptop.png' %}" alt="TechZone" style="width:72px; margin-bottom:18px;">
      <h1>Welcome Back!</h1>
      <p>To keep connected with us please login with your personal info</p>
      <a href="{% url 'signup' %}" class="sign-in-btn">SIGN UP</a>


    </div>

    <div class="form-section">
      {% comment %}
        If you have a server-side Django login form, set `login_form` in the view and the template will render it.
        Otherwise the JS form below will call the JWT endpoint via auth.js.
      {% endcomment %}

      {% if login_form %}
        <form method="POST" action="{% url 'login' %}">
          {% csrf_token %}
          <div class="form-group">
            <label for="id_username">Username</label>
            {{ login_form.username }}
          </div>
          <div class="form-group">
            <label for="id_password">Password</label>
            {{ login_form.password }}
          </div>
          <button type="submit" class="signup-btn">Sign In</button>
        </form>
      {% else %}
        <form id="jsLoginForm">
          <div class="form-group">
            <label for="username">Username or Email</label>
            <input id="username" name="username" type="text" required>
          </div>
          <div class="form-group">
            <label for="password">Password</label>
            <input id="password" name="password" type="password" required>
          </div>
          <button type="submit" class="signup-btn">Sign In</button>
        </form>

        <script>
          document.getElementById('jsLoginForm')?.addEventListener('submit', async function(e){
            e.preventDefault();
            const u = document.getElementById('username').value;
            const p = document.getElementById('password').value;
            try {
              if (typeof login === 'function') {
                await login(u, p);
              } else {
                const resp = await fetch('/api/auth/token/', {
                  method: 'POST',
                  headers: {'Content-Type':'application/json'},
                  body: JSON.stringify({ username: u, password: p})
                });
                if (!resp.ok) throw await resp.json();
                const data = await resp.json();
                localStorage.setItem('access_token', data.access);
                localStorage.setItem('refresh_token', data.refresh);
              }
              window.location.href = '/';
            } catch (err) {
              const msg = (err && err.detail) ? err.detail : 'Login failed';
              alert(msg);
            }
          });
        </script>
      {% endif %}

      <p style="margin-top: 12px; color:#666; font-size:0.95rem">
        Don't have an account? <a href="{% url 'signup' %}">Sign up</a>
      </p>
    </div>
  </div>

  <script src="{% static 'Javascript/auth.js' %}"></script>
</body>
</html>
